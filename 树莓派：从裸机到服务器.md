#树莓派：从裸机到服务器

本文介绍了将树莓派2代主机配置为一台全能服务器的流程。

[TOC]


安装操作系统及部署基础环境
----------------------

###安装操作系统

目前，树莓派官网提供[多种预制好的系统镜像][osList]可供选择。（这些镜像就像是盗版Windows的Ghost镜像一样：把文件解压出来，就相当于安装好了80%；剩下20%是首次进入系统的配置过程。）我们选用Raspbian系统。我们有两个选择来安装这个系统：

1. 直接安装系统镜像（安装方法[见此][instalOSimage]）：这样安装得到的版本较旧，所以舍弃；
2. 通过[NOOBS“系统安装器”][NOOBS]安装。这样得到的系统干净整洁。


[osList]: https://www.raspberrypi.org/downloads/
[instalOSimage]: https://www.raspberrypi.org/documentation/installation/installing-images/README.md
[NOOBS]: http://www.raspberrypi.org/help/noobs-setup/

###安装基础远程控制程序

我们考虑到，树莓派作为便携电脑，其多种应用场景中都是不具备显示器的。因此，远程访问及控制都是非常基础及必要的。

事实上，这就已然是两种网络服务了。

####字符界面远程登录：使用SSH

[SSH][]功能可以通过`raspi-config`程序开启。

[SSH]: https://www.raspberrypi.org/documentation/remote-access/ssh/

####图形界面远程登录
#####使用VNC
######TightVNC
一开始，我选用了`tightvncserver`，其安装方法如下：

    sudo apt-get install tightvncserver #http://www.raspberrypi.org/documentation/remote-access/vnc/

但是发现每次启动这个服务的时候，都会开启一个新的桌面空间——换句话说，不能与通过HDMI连接的显示器共用同一个桌面。在这种情况下，如果想要通过VNC找到一个物理显示器上的窗口，就无法实现。

######x11VNC
因此，我改用`x11vnc`这个软件。

    sudo apt-get install x11vnc #http://jingyan.baidu.com/article/e5c39bf588889039d660337e.html
    x11vnc -storepasswd #输入两次密码，密码将保存在/home/pi/.vnc/passwd文件里。

接下来，我们要设置让x11vnc随系统自动启动，这样的话，等到以后我们把显示器撤下，也可以直接访问图形界面了——不必每次在进行远程控制之前先接到显示器上、手动打开图形界面远程控制服务。

    mkdir ~/.config/autostart
    #然后创建x11vnc.desktop文件。请参见<http://blog.csdn.net/tstarrow/article/details/38238203>

#####windows远程桌面服务

    sudo apt-get install xrdp

###网络配置

由于各个地区（学校、寝室、家里等）网络配置不同，这里不多费口舌。_附注：北交大的`phone.wlan.bjtu`系`PEAP`加密模式。_

要配置上自动加入网络，这样才能保证每次开机不需连接显示器就可以通过网络访问。

_注：有的无线网卡需要单独的包作驱动。比如`TL-WN322G+`需要`zd1211-firmware`。_

###安装文件系统协议

####读取Windows系统下的存储介质：安装文件系统驱动

考虑到Raspbian是基于Debian的linux系统（没有内置NTFS驱动），而在很多的情况下（尤其是Windows设备较多的环境里），与NTFS文件系统的存储介质进行通信是很有必要的。因此，我们来安装NTFS驱动。

    sudo apt-get install ntfs-3g #给树莓派安装NTFS驱动

####`xfs`等文件系统也可以如法炮制

同理，只是需要安装的软件包不同而已。`apt-get`软件包管理器是Debian系统下常用的工具，可以简单地通过命令行的形式来安装软件。

###为Linux系统玩家准备的贴心设置

包括解压缩软件、一个更好的shell环境、Python编程语言的模块管理器等等：

    sudo apt-get install atool #http://www.nongnu.org/atool/: Linux下的Universal Unzipper #解压就：atool -x 文件名
    curl -L https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh | sh #http://ohmyz.sh/：安装一个更好的shell环境
    sudo apt-get install python-qt4 #安装Python的一种图形界面开发包
    curl -O https://bootstrap.pypa.io/get-pip.py 
    #这个文件用来安装Python的一种包管理器：pip。
    sudo python get-pip.py #安装pip
    #Do not use "sudo apt-get install python-pip" directly, since is would install Python 2.6.


安装各类服务
----------

终于开始进行核心主题了。

###兼容各种系统的局域网共享

####加入Windows网上邻居

我们需要安装Samba协议。

    sudo apt-get install samba samba-common-bin #给树莓派安装SMB文件共享协议的*nix实现——Samba——以同Windows网络进行文件共享。
    sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.old
    sudo nano /etc/samba/smb.conf

接下来请参见[这篇文章][smb_htg]。

[smb_htg]: http://www.howtogeek.com/139433/how-to-turn-a-raspberry-pi-into-a-low-power-network-storage-device/

####让OS X系统可以自动发现到

这个是通过安装苹果的`netatalk`协议实现的。这个协议，也有树莓派平台上的[实现](https://www.davidschlachter.com/misc/netatalk3rpi)。

###将树莓派打造成智能云备份

####将树莓派模拟成为苹果公司的`Time Machine`无线备份器
这也是通过`netatalk`协议实现的。但是我的树莓派才16GB的闪存，而电脑有250GB…还是不开了吧。

####网站般的通用云服务：OwnCloud
    cd ~
    git clone git://github.com/petrockblog/OwncloudPie.git
    cd OwncloudPie
    chmod +x owncloudpie_setup.sh
    sudo apt-get install -y dialog
    sudo ./owncloudpie_setup.sh
    #然后按照提示操作。在这之后，nginx也被安装上了。nginx服务程序的配置文件在但是OwnCloud自己的配置文件
    sudo nano /etc/nginx/sites-enabled/default
    #需要将 index index.php这行加上个index.htm啥的，看情况。

###将树莓派打造成低功耗下载机

####Aria2
    sudo apt-get install aria2 #安装Aria2: 下载服务。
    #配置Aria2。请参见：http://ju.outofmemory.cn/entry/1352
    #让Aria2下载服务自动启动。请参见：http://www.shumeipai.net/thread-19154-1-1.html

####BT下载机

网上已经有人提供了全面的[操作指南][btserver]。

[btserver]: http://www.instructables.com/id/Raspberry-Pi-Torrent-Samba-and-DLNA-with-3-hard-dr/?ALLSTEPS

####或者使用迅雷公司提供的全套软件
迅雷1.0.31固件:

* 下载：<http://dl.lazyzhu.com/file/Thunder/Xware/1.0.31/>
* 原帖地址：<http://luyou.xunlei.com/thread-12545-1-1.html>
###将树莓派打造成媒体服务器

网上已经有人提供了全面的[操作指南][mediaserver]。

[mediaserver]: http://www.instructables.com/id/Raspberry-Pi-Media-Server-MiniDLNA/?ALLSTEPS




参考
------
* 快速上手指南：http://www.raspberrypi.org/help/quick-start-guide/
* How to Run script at boot: http://www.raspberrypi.org/forums/viewtopic.php?f=48&t=70520
* “update-rc.d命令详解”：http://wangyan.org/blog/ubuntu-update-rc-d.html
* Raspberry Pi utilities for OS X：http://ivanx.com/raspberrypi/
* 将树莓派做成笔记本电脑：http://www.rs-online.com/designspark/electronics/chn/blog/content-947
* 以后可能也许会用到screen这个命令：http://bbs.ickey.cn/group-topic-id-37109.html